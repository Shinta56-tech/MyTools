Option Explicit

'===============================================================================================
'シート目次を更新する
Public Sub UpdateSheetIndex()
    
    '定数宣言
    Const strHeadLineNumberFormatLocal = ";;"
    Dim rngSheetIndex As Range
    Dim rngSearchRange As Range
    Set rngSheetIndex = ActiveSheet.Range("シート目次")
    Set rngSearchRange = ActiveSheet.Cells
    
    '変数宣言
    Dim rngTmpFindCell As Range
    Dim strFindFirstAddress As String
    Dim lColNum As Long
    
    'シート目次をクリア
    rngSheetIndex.CurrentRegion.Offset(1, 0).Clear
    
    '文字有、表示形式（※定数参照）を検索する
    Application.FindFormat.Clear
    Application.FindFormat.NumberFormatLocal = strHeadLineNumberFormatLocal
    Set rngTmpFindCell = rngSearchRange.Find( _
        What:="?*" _
        , SearchFormat:=True _
        )
    
    '初回検索結果がなし→終了
    If rngTmpFindCell Is Nothing Then Exit Sub
    
    '初回検索アドレスの格納
    strFindFirstAddress = rngTmpFindCell.AddressLocal
    
    Do
        
        '見出しスタイルが適用されている場合→目次にリンクの挿入
        If rngTmpFindCell.Style.Name = "見出し 1" Then
            lColNum = 1
            GoTo output_index_label
        ElseIf rngTmpFindCell.Style.Name = "見出し 2" Then
            lColNum = 2
            GoTo output_index_label
        ElseIf rngTmpFindCell.Style.Name = "見出し 3" Then
            lColNum = 3
            GoTo output_index_label
        ElseIf rngTmpFindCell.Style.Name = "見出し 4" Then
            lColNum = 4
            GoTo output_index_label
        ElseIf rngTmpFindCell.Style.Name = "見出し 5" Then
            lColNum = 5
            GoTo output_index_label
        Else
            GoTo next_label
        End If
        
        '見出しリンクの出力行程
output_index_label:
        Set rngSheetIndex = rngSheetIndex.Offset(1, 0)
        rngSheetIndex.Offset(0, lColNum).Value = _
            "=HYPERLINK(""#'""&シート名&""'!" _
            & rngTmpFindCell.Address & """,""" _
            & rngTmpFindCell.Value & """)"
        rngSheetIndex.Style = "標準"
        
        '次のセルを検索
next_label:
        Set rngTmpFindCell = rngSearchRange.Find( _
        After:=rngTmpFindCell _
        , What:="?*" _
        , SearchFormat:=True _
        )
    Loop While strFindFirstAddress <> rngTmpFindCell.Address
    
End Sub

'===============================================================================================
'全シートの整形
Public Sub AllSheetViewClean()
    Dim ws As Worksheet
    For Each ws In ActiveWorkbook.Worksheets
        ws.Activate
        Cells(1, 1).Select
        With ActiveWindow
            .Zoom = 100
            .ScrollRow = 1
            .ScrollColumn = 1
        End With
    Next ws
    ActiveWorkbook.Worksheets(1).Activate
End Sub
